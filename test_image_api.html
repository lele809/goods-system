<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>测试图片上传API</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            border: 1px solid #ddd;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            margin: 5px;
            border-radius: 3px;
        }
        .result {
            background: #f8f9fa;
            padding: 10px;
            margin: 10px 0;
            border-radius: 3px;
            white-space: pre-wrap;
        }
        input, textarea {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
        }
        .success {
            background: #d4edda;
            color: #155724;
        }
    </style>
</head>
<body>
    <h1>商品图片API测试</h1>
    
    <div class="test-section">
        <h3>1. 测试获取商品列表</h3>
        <button onclick="testGetProducts()">获取商品列表</button>
        <div id="products-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h3>2. 测试添加带图片的商品</h3>
        <input type="text" id="productName" placeholder="商品名称" value="测试商品带图片">
        <input type="text" id="productSpec" placeholder="规格" value="测试规格">
        <input type="text" id="productUnit" placeholder="单位" value="个">
        <input type="number" id="initialStock" placeholder="初始库存" value="10">
        <input type="number" id="price" placeholder="单价" value="15.50" step="0.01">
        <textarea id="imageUrl" placeholder="图片URL（可选）" rows="3">data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==</textarea>
        <button onclick="testAddProduct()">添加商品</button>
        <div id="add-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h3>3. 测试更新商品图片</h3>
        <input type="number" id="updateProductId" placeholder="商品ID" value="1">
        <textarea id="updateImageUrl" placeholder="新的图片URL" rows="3">data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8/5+hHgAHggJ/PchI7wAAAABJRU5ErkJggg==</textarea>
        <button onclick="testUpdateProduct()">更新商品图片</button>
        <div id="update-result" class="result"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8084/api';
        
        async function makeRequest(url, options = {}) {
            try {
                const response = await fetch(API_BASE + url, {
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    },
                    ...options
                });
                
                const data = await response.json();
                return { success: response.ok, data };
            } catch (error) {
                return { success: false, error: error.message };
            }
        }
        
        async function testGetProducts() {
            const resultDiv = document.getElementById('products-result');
            resultDiv.textContent = '正在获取商品列表...';
            
            const result = await makeRequest('/products?page=0&size=5');
            
            if (result.success) {
                resultDiv.className = 'result success';
                resultDiv.textContent = '✅ 获取成功:\n' + JSON.stringify(result.data, null, 2);
            } else {
                resultDiv.className = 'result error';
                resultDiv.textContent = '❌ 获取失败:\n' + (result.error || JSON.stringify(result.data, null, 2));
            }
        }
        
        async function testAddProduct() {
            const resultDiv = document.getElementById('add-result');
            resultDiv.textContent = '正在添加商品...';
            
            const productData = {
                name: document.getElementById('productName').value,
                spec: document.getElementById('productSpec').value,
                unit: document.getElementById('productUnit').value,
                initialStock: parseInt(document.getElementById('initialStock').value),
                price: parseFloat(document.getElementById('price').value),
                amount: parseInt(document.getElementById('initialStock').value) * parseFloat(document.getElementById('price').value),
                remainingQuantity: parseInt(document.getElementById('initialStock').value),
                imageUrl: document.getElementById('imageUrl').value || null
            };
            
            const result = await makeRequest('/product', {
                method: 'POST',
                body: JSON.stringify(productData)
            });
            
            if (result.success) {
                resultDiv.className = 'result success';
                resultDiv.textContent = '✅ 添加成功:\n' + JSON.stringify(result.data, null, 2);
                // 自动刷新商品列表
                setTimeout(testGetProducts, 1000);
            } else {
                resultDiv.className = 'result error';
                resultDiv.textContent = '❌ 添加失败:\n' + (result.error || JSON.stringify(result.data, null, 2));
            }
        }
        
        async function testUpdateProduct() {
            const resultDiv = document.getElementById('update-result');
            const productId = document.getElementById('updateProductId').value;
            resultDiv.textContent = '正在更新商品...';
            
            // 先获取商品信息
            const getResult = await makeRequest(`/product/${productId}`);
            if (!getResult.success) {
                resultDiv.className = 'result error';
                resultDiv.textContent = '❌ 获取商品信息失败:\n' + (getResult.error || JSON.stringify(getResult.data, null, 2));
                return;
            }
            
            // 更新图片URL
            const productData = {
                ...getResult.data.data,
                imageUrl: document.getElementById('updateImageUrl').value
            };
            
            const result = await makeRequest('/product', {
                method: 'POST',
                body: JSON.stringify(productData)
            });
            
            if (result.success) {
                resultDiv.className = 'result success';
                resultDiv.textContent = '✅ 更新成功:\n' + JSON.stringify(result.data, null, 2);
                // 自动刷新商品列表
                setTimeout(testGetProducts, 1000);
            } else {
                resultDiv.className = 'result error';
                resultDiv.textContent = '❌ 更新失败:\n' + (result.error || JSON.stringify(result.data, null, 2));
            }
        }
        
        // 页面加载时自动测试获取商品列表
        window.onload = function() {
            testGetProducts();
        };
    </script>
</body>
</html> 